<h1 id=""></h1>
<h2 id="movie-crud">Movie-CRUD</h2>
<p>Naast het ophalen van gegevens kun je ook de gebruikelijke create, update en delete acties uitvoeren. Het komt vaak voor dat je voor een model al deze acties beschikbaar wilt hebben. In het geval van de movie-app moeten users, movies en ratings kunnen worden aangemaakt en aangepast in de applicatie.<br>
Laravel biedt hiervoor de resource-controller. Een resource-controller biedt de standaard 'CRUD'-functionaliteit voor een model.<br>
Let op: Als je de vorige hoofdstukken hebt gevolgd, dan heb je al een model voor een movie. Bewaar de gemaakte methoden in het model even in een apart bestand, zodat je ze later weer toe kunt voegen aan het resource-model.
Hieronder zie je om welke methoden het gaat:</p>
<pre class="language-php"><code class="language-php">    <span class="token keyword">function</span> <span class="token function-definition function">showWithAvgRating</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name static-context">Movie</span><span class="token operator">::</span><span class="token function">withAvg</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ratings'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'rating'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//en</span>
        <span class="token keyword">function</span> <span class="token function-definition function">withMovies</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'movies'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>Verwijder de bestaande MovieController en voeg dan opnieuw een controller toe. Je kunt dit doen met de optie --resource of met de optie --api. Met --resource ga je er van uit dat de formulieren in blade worden gemaakt, met --api worden alleen de routes aangemaakt om de CRUD acties uit te voeren. In deze applicatie gaan we de frontend zoveel mogelijk in een aparte app maken dus kiezen we hier voor:</p>
<pre class="language-php"><code class="language-php">php artisan make<span class="token punctuation">:</span>MovieController <span class="token operator">--</span>api</code></pre>
<p>Je krijgt nu opnieuw een MovieController, maar dan met de signatuur voor alle mogelijke CRUD functies (store, update en destroy). De functionaliteit voor de methoden moet nog wel worden toegevoegd.</p>
<h2 id="resource-controller">Resource controller</h2>
<p>Het voordeel van een resource-controller is dat je in de routes met veel minder code toe kan om de verschillende CRUD functionaliteiten te activeren.</p>
<pre class="language-php"><code class="language-php"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'movies'</span><span class="token punctuation">,</span> <span class="token class-name static-context">MovieController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>De Route::resource staat gelijk aan:</p>
<pre class="language-php"><code class="language-php"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/movies'</span><span class="token punctuation">,</span> <span class="token class-name static-context">MovieController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'index'</span><span class="token punctuation">)</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/movies'</span><span class="token punctuation">,</span> <span class="token class-name static-context">MovieController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'store'</span><span class="token punctuation">)</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/movies/{movie}'</span><span class="token punctuation">,</span> <span class="token class-name static-context">MovieController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'show'</span><span class="token punctuation">)</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/movies/{movie}'</span><span class="token punctuation">,</span> <span class="token class-name static-context">MovieController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'update'</span><span class="token punctuation">)</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/movies/{movie}'</span><span class="token punctuation">,</span> <span class="token class-name static-context">MovieController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'destroy'</span><span class="token punctuation">)</span></code></pre>
<p>Om dezelfde functionaliteit voor de users en ratings te genereren maak je nog 2 ResourceControllers aan:</p>
<pre class="language-php"><code class="language-php">php artisan make<span class="token punctuation">:</span>UserController <span class="token operator">--</span>api
php artisan make<span class="token punctuation">:</span>RatingsController <span class="token operator">--</span>api

<span class="token comment">//Voeg de routes toe aan routes/api.php</span>

<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token class-name static-context">UserController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ratings'</span><span class="token punctuation">,</span> <span class="token class-name static-context">RatingController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
